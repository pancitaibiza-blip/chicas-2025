<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FORTNITE SKIN BATTLE: ¬°DERROTA AL JEF√â!</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oxanium:wght@600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Oxanium', sans-serif;
      color: white;
      text-align: center;
      margin: 0;
      padding: 10px;
      background: #0a0a1a;
      position: relative;
      overflow-x: hidden;
      min-height: 100vh;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(ellipse at center, #1a1a2e 0%, #0a0a1a 70%);
      z-index: -3;
    }
    body::after {
      content: '';
      position: fixed;
      top: 15%; right: 8%;
      width: 350px; height: 350px;
      background: radial-gradient(circle, rgba(106, 27, 154, 0.3) 0%, transparent 70%);
      border-radius: 50%;
      filter: blur(30px);
      animation: pulseGlow 8s infinite alternate;
      z-index: -2;
    }
    @keyframes pulseGlow { 0% { opacity: 0.4; transform: scale(1); } 100% { opacity: 0.8; transform: scale(1.1); } }
    .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
    .particle { position: absolute; border-radius: 50%; animation: float 15s infinite linear; }
    @keyframes float { to { transform: translate(var(--tx), var(--ty)) rotate(360deg); opacity: 0; } }

    .content { position: relative; z-index: 10; opacity: 0; animation: fadeIn 1.5s forwards; }
    @keyframes fadeIn { to { opacity: 1; } }

    h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 2.2em;
      color: #ff6b6b;
      text-shadow: 0 0 15px rgba(255,107,107,0.8);
      margin: 10px 0;
    }

    .trophy-bar {
      background: rgba(10,10,26,0.7);
      padding: 12px;
      border-radius: 12px;
      margin: 15px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.2em;
      border: 2px solid gold;
    }
    .trophy-icon { font-size: 1.5em; margin-right: 8px; }
    .league-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.95em;
    }
    .league-bronze { background: linear-gradient(to right, #cd7f32, #b8860b); }
    .league-silver { background: linear-gradient(to right, silver, #c0c0c0); color: #333; }
    .league-gold { background: linear-gradient(to right, gold, #daa520); }
    .league-elite { background: linear-gradient(to right, #4b0082, #8a2be2); }
    .league-legend { background: linear-gradient(45deg, red, gold, blue); animation: rainbow 3s linear infinite; }

    .nav-buttons {
      margin: 15px 0;
    }
    .nav-btn {
      background: rgba(78,205,196,0.2);
      color: white;
      border: 1px solid #4ecdc4;
      padding: 8px 16px;
      margin: 0 5px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .nav-btn.active {
      background: #4ecdc4;
      color: #0a0a1a;
      font-weight: bold;
    }

    .deck-section {
      background: rgba(10,10,26,0.6);
      padding: 15px;
      border-radius: 12px;
      margin: 20px 0;
      border: 1px solid #4ecdc4;
    }
    .deck-title {
      margin: 10px 0;
      color: #4ecdc4;
    }

    /* TIENDA BLOQUEADA */
    .store-countdown {
      margin: 20px auto;
      max-width: 500px;
      background: rgba(10,10,26,0.5);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      border: 1px dashed gold;
      display: none;
    }
    .store-section {
      margin: 20px auto;
      max-width: 500px;
      background: rgba(10,10,26,0.5);
      padding: 15px;
      border-radius: 15px;
      border: 1px solid #ff6b6b;
      display: none;
    }
    .store-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-top: 15px;
    }
    .store-item {
      background: rgba(25,25,45,0.8);
      padding: 10px;
      border-radius: 10px;
    }
    .store-item.gold { border-left: 4px solid gold; }
    .store-item.orange { border-left: 4px solid #ff6b35; }
    .store-item.purple { border-left: 4px solid #a29bfe; }

    /* COLECCI√ìN MEJORADA */
    .collection {
      display: none;
      margin: 20px auto;
      max-width: 600px;
    }
    .collection-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 12px;
      margin-top: 15px;
    }
    .collection-card {
      background: rgba(20,20,40,0.8);
      border-radius: 10px;
      padding: 8px;
      position: relative;
      opacity: 0.6;
      cursor: not-allowed;
      transition: opacity 0.2s;
    }
    .collection-card.unlocked {
      opacity: 1;
      cursor: pointer;
    }
    .collection-card.locked::after {
      content: "üîí";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.8em;
      color: #ff6b6b;
    }
    .collection-card img {
      width: 100%;
      border-radius: 6px;
      border: 2px solid #333;
    }

    /* Vista detallada de carta */
    .card-preview {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: rgba(10,10,26,0.95);
      padding: 20px;
      border-radius: 15px;
      max-width: 300px;
      z-index: 2000;
      border: 3px solid gold;
      box-shadow: 0 0 30px gold;
      opacity: 0;
      transition: all 0.3s ease;
    }
    .card-preview.show {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    .card-preview img {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 12px;
    }
    .rarity-tag {
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: bold;
      display: inline-block;
      margin: 5px 0;
    }
    .rarity-common-tag { background: rgba(255,255,255,0.2); color: white; }
    .rarity-rare-tag { background: rgba(255,107,53,0.3); color: #ff6b35; }
    .rarity-epic-tag { background: rgba(162,155,254,0.3); color: #a29bfe; }
    .rarity-legendary-tag { 
      background: linear-gradient(45deg, red, gold, blue);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      font-weight: bold;
    }

    /* Cartas en batalla y mazo */
    .card {
      background: rgba(20,20,40,0.8);
      border-radius: 12px;
      padding: 12px;
      margin: 10px;
      display: inline-block;
      width: 140px;
      cursor: pointer;
      transition: transform 0.2s;
      position: relative;
      border: 2px solid #333;
    }
    .card.fainted { opacity: 0.4; filter: grayscale(100%); cursor: not-allowed; }
    .card.in-deck { box-shadow: 0 0 10px gold; }
    .card:hover { transform: scale(1.03); }
    .card img { width: 100%; border-radius: 8px; }

    .rarity-common { border-color: white; box-shadow: 0 0 8px rgba(255,255,255,0.4); }
    .rarity-rare { border-color: #ff6b35; box-shadow: 0 0 12px rgba(255,107,53,0.6); }
    .rarity-epic { border-color: #a29bfe; box-shadow: 0 0 15px rgba(162,155,254,0.7); }
    .rarity-legendary { 
      border-color: gold;
      box-shadow: 0 0 20px gold;
      animation: legendaryGlow 2s infinite alternate;
    }
    @keyframes legendaryGlow {
      0% { box-shadow: 0 0 15px gold; }
      100% { box-shadow: 0 0 25px gold, 0 0 35px rgba(255,0,0,0.5), 0 0 35px rgba(0,0,255,0.5); }
    }

    .rarity-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 0.7em;
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 10px;
      background: rgba(0,0,0,0.6);
    }
    .rarity-common .rarity-badge { color: white; }
    .rarity-rare .rarity-badge { color: #ff6b35; }
    .rarity-epic .rarity-badge { color: #a29bfe; }
    .rarity-legendary .rarity-badge { 
      color: transparent;
      background: linear-gradient(45deg, red, gold, blue, purple);
      -webkit-background-clip: text;
      background-clip: text;
      animation: rainbow 3s linear infinite;
    }
    @keyframes rainbow { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

    .enemy-card .card { transform: scale(1.1); position: relative; }

    .attack-effect {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: 10;
    }
    .fire { background: radial-gradient(circle, rgba(255,90,0,0.7) 0%, transparent 70%); animation: fireBurst 0.8s forwards; }
    .ice { background: radial-gradient(circle, rgba(0,200,255,0.6) 0%, transparent 70%); animation: iceShatter 0.8s forwards; }
    .wind { background: radial-gradient(circle, rgba(100,255,200,0.5) 0%, transparent 70%); animation: windSwirl 0.8s forwards; }
    .arcane { background: radial-gradient(circle, rgba(200,100,255,0.7) 0%, transparent 70%); animation: arcanePulse 0.8s forwards; }

    @keyframes fireBurst { 0% { opacity: 0.8; transform: scale(0.5); } 100% { opacity: 0; transform: scale(2); } }
    @keyframes iceShatter { 0% { opacity: 0.9; transform: scale(0.3); } 50% { opacity: 0.9; } 100% { opacity: 0; transform: scale(1.5); } }
    @keyframes windSwirl { 0% { opacity: 0.7; transform: rotate(0) scale(0.5); } 100% { opacity: 0; transform: rotate(180deg) scale(2); } }
    @keyframes arcanePulse { 0% { opacity: 0.9; transform: scale(0.4); box-shadow: 0 0 10px #c864ff; } 50% { box-shadow: 0 0 20px #ff64c8, 0 0 30px #64c8ff; } 100% { opacity: 0; transform: scale(1.8); } }

    .battle-area, .coming-soon {
      margin: 20px auto;
      max-width: 600px;
      background: rgba(10,10,26,0.6);
      border-radius: 15px;
      padding: 20px;
      border: 2px solid #4ecdc4;
    }
    .battle-log {
      background: rgba(0,0,0,0.5);
      padding: 12px;
      border-radius: 10px;
      margin: 15px 0;
      min-height: 80px;
      font-size: 1.1em;
      color: #feca57;
    }
    .action-btn {
      background: #4ecdc4;
      color: #0a0a1a;
      border: none;
      padding: 10px 20px;
      font-size: 1.1em;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      margin: 10px 5px;
      transition: all 0.3s;
    }
    .action-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }

    .coming-soon {
      border: 2px dashed gold;
    }
    .coming-soon h3 {
      color: gold;
      font-family: 'Bebas Neue';
    }

    @media (max-width: 500px) {
      .card, .collection-card { width: 100px; }
      h1 { font-size: 1.9em; }
      .trophy-bar { flex-direction: column; gap: 8px; }
      .card-preview { width: 90%; padding: 15px; }
    }
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>
  <div class="content">
    <h1>FORTNITE SKIN BATTLE: ¬°DERROTA AL JEF√â!</h1>
    
    <div class="trophy-bar">
      <div>
        <span class="trophy-icon">üèÜ</span>
        <span id="trophyCount">0</span> copas
      </div>
      <div class="league-badge" id="leagueBadge">Bronce</div>
    </div>

    <div class="nav-buttons">
      <button class="nav-btn active" onclick="showView('battle')">‚öîÔ∏è Batalla</button>
      <button class="nav-btn" onclick="showView('collection')">üÉè Colecci√≥n</button>
    </div>

    <div class="battle-area" id="battleArea">
    </div>

    <div class="collection" id="collectionView">
      <h2 style="color: #4ecdc4;">Mi Colecci√≥n</h2>
      <p>Selecciona cartas desbloqueadas para tu mazo.</p>
      <div class="collection-grid" id="collectionGrid">
      </div>
      
      <div class="deck-section">
        <div class="deck-title">Mazo Actual (3 cartas)</div>
        <div id="currentDeck" style="display:flex; justify-content:center; flex-wrap:wrap; gap:10px;"></div>
        <button class="action-btn" onclick="saveDeck()" style="margin-top:10px;">üíæ Guardar Mazo</button>
      </div>
    </div>

    <!-- üîë TIENDA: HOY A LA 1:00 AM -->
    <div class="store-countdown" id="storeCountdown">
      <h3 style="color: gold; font-family:'Bebas Neue';">‚è≥ ¬°TIENDA DISPONIBLE HOY A LA 1:00 AM! ‚è≥</h3>
      <div id="storeTimer" style="font-size:1.4em; color:gold; margin:10px 0; font-weight:bold;"></div>
    </div>

    <div class="store-section" id="storeSection">
      <h3 style="color:gold; font-family:'Bebas Neue'">üõí TIENDA DE BATALLA</h3>
      <div class="store-items">
        <div class="store-item gold">
          <div style="font-weight:bold;">Skin Dorada</div>
          <div class="power">+30 DEF</div>
          <div style="color:gold; font-weight:bold;">50 üíé</div>
          <button class="action-btn" onclick="buyItem('golden_skin',50)" style="font-size:0.85em; padding:4px 8px; margin-top:5px;">Comprar</button>
        </div>
        <div class="store-item purple">
          <div style="font-weight:bold;">Confeti √âpico</div>
          <div class="power">Ataque Sorpresa</div>
          <div style="color:gold; font-weight:bold;">30 üíé</div>
          <button class="action-btn" onclick="buyItem('epic_confetti',30)" style="font-size:0.85em; padding:4px 8px; margin-top:5px;">Comprar</button>
        </div>
        <div class="store-item orange">
          <div style="font-weight:bold;">Doble Voto</div>
          <div class="power">Doble Ataque</div>
          <div style="color:gold; font-weight:bold;">70 üíé</div>
          <button class="action-btn" onclick="buyItem('double_vote',70)" style="font-size:0.85em; padding:4px 8px; margin-top:5px;">Comprar</button>
        </div>
      </div>
      <p id="storeMessage" style="margin-top:10px; color:#4ecdc4; font-style:italic;"></p>
    </div>

    <div class="coming-soon">
      <h3>üîî ¬°PR√ìXIMA ACTUALIZACI√ìN! üîî</h3>
      <p><strong>Ma√±ana a las 15:00</strong></p>
      <p>¬°Llegan los <span style="color:gold; font-weight:bold;">Cofres √âpicos</span>! üéÅ</p>
      <div id="updateTimer" style="font-size:1.3em; color:#4ecdc4; margin:10px 0; font-weight:bold;"></div>
    </div>
  </div>

  <!-- Vista detallada de carta -->
  <div class="card-preview" id="cardPreview">
    <img id="previewImg" src="" alt="">
    <h3 id="previewName"></h3>
    <div id="previewRarity" class="rarity-tag"></div>
    <div id="previewStats"></div>
    <div id="previewPower" style="color:gold; font-style:italic;"></div>
  </div>

  <audio id="hitSound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" preload="auto"></audio>
  <audio id="loseSound" src="https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-lose-2027.mp3" preload="auto"></audio>
  <audio id="winSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" preload="auto"></audio>
  <audio id="levelUpSound" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-new-level-2195.mp3" preload="auto"></audio>

  <script>
    // ==== DATOS ====
    let CARDS = [
      { id:0, name:"Ram√≠rez", img:"https://s93.erome.com/5472/K3IRZbxx/Y8DPmT76.jpeg?v=1764825894", rarity:"common", atk:60, def:50, power:"Paso Firme", attackType:"wind", unlocked: true },
      { id:1, name:"Azulita", img:"https://s93.erome.com/5472/K3IRZbxx/0B8OzReu.jpeg?v=1764815871", rarity:"rare", atk:70, def:55, power:"Confeti √Åcido", attackType:"fire", unlocked: true },
      { id:2, name:"Tormenta", img:"https://s93.erome.com/5472/K3IRZbxx/7GmdJa3U.jpeg?v=1764802552", rarity:"epic", atk:80, def:45, power:"Torbellino", attackType:"wind", unlocked: false },
      { id:3, name:"Fortaleza", img:"https://s93.erome.com/5472/K3IRZbxx/1FvcJ5u7.png?v=1764809177", rarity:"rare", atk:60, def:70, power:"Muralla", attackType:"ice", unlocked: true },
      { id:4, name:"Danza", img:"https://s93.erome.com/5472/K3IRZbxx/0VxSvgAl.jpeg?v=1764818017", rarity:"epic", atk:75, def:50, power:"Baile √âpico", attackType:"wind", unlocked: false },
      { id:5, name:"Furia", img:"https://s93.erome.com/5472/K3IRZbxx/LsMURibY.jpeg?v=1764812622", rarity:"legendary", atk:90, def:40, power:"Ira Incontenible", attackType:"fire", unlocked: false },
      { id:6, name:"Escudera", img:"https://s93.erome.com/5472/K3IRZbxx/9RweIpam.jpeg?v=1764813677", rarity:"common", atk:55, def:65, power:"Protecci√≥n", attackType:"ice", unlocked: true },
      { id:7, name:"Asesina", img:"https://s206.erome.com/4699/lpRzYjBO/Z5Tc5k2v.jpeg?v=1745795818", rarity:"legendary", atk:95, def:30, power:"Golpe Letal", attackType:"fire", unlocked: false },
      { id:8, name:"Guardiana", img:"https://s206.erome.com/4699/lpRzYjBO/P9p2wv5y.jpeg?v=1745795818", rarity:"epic", atk:50, def:80, power:"Escudo Energ√©tico", attackType:"ice", unlocked: false },
      { id:9, name:"JEFE FINAL", img:"https://s206.erome.com/4699/lpRzYjBO/gU2HfmRY.jpeg?v=1745795818", rarity:"legendary", atk:100, def:35, power:"Tirano", attackType:"arcane", unlocked: false }
    ];

    const LEAGUES = [
      { name: "Bronce", min: 0, max: 199, badgeClass: "league-bronze" },
      { name: "Plata", min: 200, max: 399, badgeClass: "league-silver" },
      { name: "Oro", min: 400, max: 599, badgeClass: "league-gold" },
      { name: "√âlite", min: 600, max: 799, badgeClass: "league-elite" },
      { name: "Leyenda", min: 800, max: Infinity, badgeClass: "league-legend" }
    ];

    // ==== ESTADO ====
    let playerCards = [];
    let enemyCard = null;
    let round = 1;
    let gameActive = true;
    let playerTurn = true;
    let trophies = parseInt(localStorage.getItem('trophies')) || 0;
    let currentLeague = LEAGUES[0];
    let currentDeck = JSON.parse(localStorage.getItem('currentDeck')) || [0, 3, 6];
    let credits = 100;

    // Cargar cartas
    const savedCards = JSON.parse(localStorage.getItem('cards')) || {};
    CARDS.forEach(card => {
      if (savedCards[card.id] !== undefined) {
        card.unlocked = savedCards[card.id];
      }
    });

    // ==== FUNCIONES ====
    function saveCollection() {
      const state = {};
      CARDS.forEach(card => state[card.id] = card.unlocked);
      localStorage.setItem('cards', JSON.stringify(state));
    }

    function updateTrophies() {
      localStorage.setItem('trophies', trophies);
      document.getElementById('trophyCount').innerText = trophies;
      
      const newLeague = LEAGUES.find(l => trophies >= l.min && trophies <= l.max) || LEAGUES[0];
      if (newLeague.name !== currentLeague.name) {
        currentLeague = newLeague;
        document.getElementById('levelUpSound').play().catch(()=>{});
        showNotification(`¬°Ascendiste a ${newLeague.name}! üéâ`);
        const unlockIndex = Math.min(LEAGUES.indexOf(newLeague), CARDS.length - 1);
        if (CARDS[unlockIndex] && !CARDS[unlockIndex].unlocked) {
          CARDS[unlockIndex].unlocked = true;
          saveCollection();
          if (document.getElementById('collectionView').style.display === 'block') {
            renderCollection();
          }
        }
      }
      document.getElementById('leagueBadge').className = `league-badge ${newLeague.badgeClass}`;
      document.getElementById('leagueBadge').innerText = newLeague.name;
    }

    function showNotification(msg) {
      const notif = document.createElement('div');
      notif.innerText = msg;
      notif.style.position = 'fixed';
      notif.style.top = '20%';
      notif.style.left = '50%';
      notif.style.transform = 'translateX(-50%)';
      notif.style.background = 'gold';
      notif.style.color = '#0a0a1a';
      notif.style.padding = '10px 20px';
      notif.style.borderRadius = '10px';
      notif.style.fontWeight = 'bold';
      notif.style.zIndex = '1000';
      notif.style.fontSize = '1.2em';
      document.body.appendChild(notif);
      setTimeout(() => document.body.removeChild(notif), 3000);
    }

    // ‚ú® Mostrar vista detallada
    function showCardPreview(card) {
      document.getElementById('previewImg').src = card.img;
      document.getElementById('previewName').innerText = card.name;
      
      const rarityColors = {
        common: "rarity-common-tag",
        rare: "rarity-rare-tag",
        epic: "rarity-epic-tag",
        legendary: "rarity-legendary-tag"
      };
      const rarityNames = {
        common: "Com√∫n",
        rare: "Rara",
        epic: "√âpica",
        legendary: "Legendaria"
      };
      
      const rarityEl = document.getElementById('previewRarity');
      rarityEl.className = `rarity-tag ${rarityColors[card.rarity]}`;
      rarityEl.innerText = rarityNames[card.rarity];
      
      document.getElementById('previewStats').innerText = `ATK: ${card.atk} | DEF: ${card.def}`;
      document.getElementById('previewPower').innerText = card.power;
      
      document.getElementById('cardPreview').classList.add('show');
    }

    function hideCardPreview() {
      document.getElementById('cardPreview').classList.remove('show');
    }

    document.getElementById('cardPreview').onclick = hideCardPreview;

    function renderCard(card, isEnemy = false, isFainted = false, inDeck = false) {
      const rarityClass = `rarity-${card.rarity} ${isFainted ? 'fainted' : ''} ${inDeck ? 'in-deck' : ''}`;
      return `
        <div class="card ${rarityClass}" style="${isEnemy ? 'transform:scale(1.1);' : ''}" 
             ${!isEnemy && !isFainted ? 'onclick="playerAttack(' + card.id + ')"' : ''}>
          <div class="rarity-badge">${card.rarity.slice(0,1).toUpperCase()}</div>
          <img src="${card.img}" alt="${card.name}">
          <div class="stats">ATK: ${card.atk} | DEF: ${card.def}</div>
          <div class="power">${card.power}</div>
        </div>
      `;
    }

    function renderCollection() {
      const grid = document.getElementById('collectionGrid');
      grid.innerHTML = '';
      CARDS.forEach(card => {
        const div = document.createElement('div');
        div.className = `collection-card ${card.unlocked ? 'unlocked' : 'locked'}`;
        if (card.unlocked) {
          const img = document.createElement('img');
          img.src = card.img;
          img.alt = card.name;
          div.appendChild(img);
          div.onclick = () => {
            showCardPreview(card);
            setTimeout(() => addToDeck(card.id), 1500);
          };
        }
        grid.appendChild(div);
      });

      const deckEl = document.getElementById('currentDeck');
      deckEl.innerHTML = '';
      currentDeck.forEach(id => {
        const card = CARDS.find(c => c.id === id && c.unlocked);
        if (card) {
          deckEl.innerHTML += renderCard(card, false, false, true);
        }
      });
    }

    function addToDeck(cardId) {
      if (currentDeck.length >= 3) {
        alert('Tu mazo solo puede tener 3 cartas.');
        return;
      }
      if (!currentDeck.includes(cardId)) {
        currentDeck.push(cardId);
        renderCollection();
      }
    }

    function saveDeck() {
      if (currentDeck.length !== 3) {
        alert('¬°Tu mazo debe tener exactamente 3 cartas!');
        return;
      }
      localStorage.setItem('currentDeck', JSON.stringify(currentDeck));
      showNotification('¬°Mazo guardado!');
    }

    function buyItem(id, cost) {
      if (credits >= cost) {
        credits -= cost;
        localStorage.setItem(`owned_${id}`, 'true');
        document.getElementById('storeMessage').innerText = '¬°Compra exitosa! üéâ';
        setTimeout(() => document.getElementById('storeMessage').innerText = '', 3000);
      } else {
        document.getElementById('storeMessage').innerText = '‚ùå Cr√©ditos insuficientes.';
        setTimeout(() => document.getElementById('storeMessage').innerText = '', 3000);
      }
    }

    function showView(view) {
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      document.getElementById('battleArea').style.display = view === 'battle' ? 'block' : 'none';
      document.getElementById('collectionView').style.display = view === 'collection' ? 'block' : 'none';
      
      if (view === 'collection') {
        renderCollection();
      } else if (view === 'battle') {
        startBattle();
      }
    }

    function playAttackAnimation(type, targetElement) {
      if (!targetElement) return;
      const effect = document.createElement('div');
      effect.className = `attack-effect ${type}`;
      targetElement.style.position = 'relative';
      targetElement.appendChild(effect);
      setTimeout(() => {
        if (effect.parentNode) effect.parentNode.removeChild(effect);
      }, 800);
    }

    function getEnemyByLeague() {
      const baseIndex = Math.min(round + 3, 9);
      if (currentLeague.name === "Bronce") return CARDS[Math.min(baseIndex, 5)];
      if (currentLeague.name === "Plata") return CARDS[Math.min(baseIndex + 1, 7)];
      if (currentLeague.name === "Oro") return CARDS[Math.min(baseIndex + 2, 8)];
      if (currentLeague.name === "√âlite") return CARDS[8];
      return CARDS[9];
    }

    function startBattle() {
      const savedDeck = JSON.parse(localStorage.getItem('currentDeck')) || [0,3,6];
      currentDeck = savedDeck;
      
      playerCards = [];
      currentDeck.forEach(id => {
        const card = CARDS.find(c => c.id === id && c.unlocked);
        if (card) {
          playerCards.push({...card, alive: true});
        }
      });

      if (playerCards.length === 0) {
        document.getElementById('battleArea').innerHTML = `<p style="color:#ff6b6b;">¬°Tu mazo est√° vac√≠o! Ve a "Colecci√≥n" y arma tu mazo.</p>`;
        return;
      }

      const enemy = getEnemyByLeague();
      enemyCard = {...enemy, alive: true};
      playerTurn = true;
      round = 1;
      gameActive = true;
      renderBattle();
    }

    function renderBattle() {
      if (!gameActive) return;
      let html = `<div class="enemy-card">${renderCard(enemyCard, true, !enemyCard.alive)}</div>`;
      html += `<div class="battle-log" id="battleLog">`;
      if (playerTurn) {
        html += `¬°Tu turno! Elige una carta para atacar:`;
      } else {
        html += `¬°Turno de la IA!`;
      }
      html += `</div>`;
      html += `<div class="player-hand">`;
      playerCards.forEach(card => {
        if (card.alive) {
          html += renderCard(card, false, false);
        } else {
          html += renderCard(card, false, true);
        }
      });
      html += `</div>`;
      document.getElementById('battleArea').innerHTML = html;
    }

    function playerAttack(cardId) {
      if (!gameActive || !playerTurn) return;
      
      const playerCard = playerCards.find(c => c.id === cardId && c.alive);
      if (!playerCard) return;
      
      const log = document.getElementById('battleLog');
      const enemyEl = document.querySelector('.enemy-card .card');

      const playerAtk = playerCard.atk;
      const enemyDef = enemyCard.def;
      const damage = Math.max(5, playerAtk - enemyDef);

      log.innerHTML = `¬°${playerCard.name} ataca con <strong>${playerCard.power}</strong>!`;

      if (enemyEl) {
        playAttackAnimation(playerCard.attackType, enemyEl);
        document.getElementById('hitSound').play().catch(()=>{});
      }

      setTimeout(() => {
        if (damage >= enemyDef) {
          enemyCard.alive = false;
          log.innerHTML = `¬°${playerCard.name} derrot√≥ a ${enemyCard.name}!`;
          round++;
          if (round > 5) {
            trophies += 50;
            updateTrophies();
            const lockedCards = CARDS.filter(c => !c.unlocked);
            if (lockedCards.length > 0) {
              const randomCard = lockedCards[Math.floor(Math.random() * lockedCards.length)];
              randomCard.unlocked = true;
              saveCollection();
              showNotification(`¬°Nueva carta desbloqueada: ${randomCard.name}! üéÅ`);
            }
            endGame(true);
            return;
          }
          setTimeout(() => startBattle(), 1500);
        } else {
          log.innerHTML += `<br>¬°La IA contraataca!`;
          setTimeout(() => iaAttack(), 1000);
        }
        playerTurn = false;
      }, 800);
    }

    function iaAttack() {
      if (!gameActive || playerTurn) return;
      
      const log = document.getElementById('battleLog');
      const aliveCards = playerCards.filter(c => c.alive);
      
      if (aliveCards.length === 0) {
        endGame(false);
        return;
      }

      const targetCard = aliveCards[Math.floor(Math.random() * aliveCards.length)];
      const playerDef = targetCard.def;
      const enemyAtk = enemyCard.atk;
      const damage = Math.max(5, enemyAtk - playerDef);

      log.innerHTML = `¬°${enemyCard.name} ataca a ${targetCard.name}!`;

      const playerEl = document.querySelector(`.player-hand .card`);
      if (playerEl) {
        playAttackAnimation(enemyCard.attackType, playerEl);
        document.getElementById('hitSound').play().catch(()=>{});
      }

      setTimeout(() => {
        if (damage >= playerDef) {
          targetCard.alive = false;
          log.innerHTML = `¬°${targetCard.name} fue eliminada!`;
          
          if (playerCards.filter(c => c.alive).length === 0) {
            trophies = Math.max(0, trophies - 20);
            updateTrophies();
            endGame(false);
            return;
          }
        } else {
          log.innerHTML = `¬°${targetCard.name} resisti√≥ el ataque!`;
        }
        
        round++;
        if (round > 5) {
          trophies += 50;
          updateTrophies();
          endGame(true);
        } else {
          setTimeout(() => startBattle(), 1500);
        }
      }, 800);
    }

    function endGame(isWin) {
      gameActive = false;
      const sound = isWin ? 'winSound' : 'loseSound';
      document.getElementById(sound).play();
      
      document.getElementById('battleArea').innerHTML = `
        <div style="text-align:center; padding:30px;">
          <h2 style="color:${isWin ? 'gold' : '#ff6b6b'}; text-shadow:0 0 10px ${isWin ? 'gold' : 'red'};">
            ${isWin ? 'üéâ ¬°VICTORIA ROYALE!' : 'üíÄ DERROTA'} 
          </h2>
          <p style="font-size:1.2em;">${isWin ? '¬°Ganaste 50 copas y una carta!' : 'Perdiste 20 copas.'}</p>
          <button class="action-btn" onclick="location.reload()">üîÑ Jugar de Nuevo</button>
        </div>
      `;
    }

    // ‚úÖ TIENDA: HOY A LA 1:00 AM
    function updateStoreCountdown() {
      const now = new Date();
      const target = new Date(now);
      target.setHours(1, 0, 0, 0); // 1:00 AM
      if (now >= target) {
        target.setDate(target.getDate() + 1);
      }
      const diff = target - now;
      const hours = Math.floor(diff / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      
      if (diff <= 0) {
        document.getElementById('storeCountdown').style.display = 'none';
        document.getElementById('storeSection').style.display = 'block';
      } else {
        document.getElementById('storeCountdown').style.display = 'block';
        document.getElementById('storeTimer').innerText = 
          `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      }
    }

    function updateUpdateCountdown() {
      const now = new Date();
      const target = new Date(now);
      target.setHours(15, 0, 0, 0);
      if (now >= target) target.setDate(target.getDate() + 1);
      const diff = target - now;
      const hours = Math.floor(diff / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      
      if (diff <= 0) {
        document.getElementById('updateTimer').innerText = '¬°Los cofres ya est√°n disponibles! üéÅ';
      } else {
        document.getElementById('updateTimer').innerText = 
          `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      }
    }

    // ==== INICIAR ====
    createParticles();
    updateTrophies();
    updateStoreCountdown();
    setInterval(updateStoreCountdown, 1000);
    updateUpdateCountdown();
    setInterval(updateUpdateCountdown, 1000);
    showView('battle');

    function createParticles() {
      const c = document.getElementById('particles');
      const n = window.innerWidth > 768 ? 25 : 15;
      for (let i = 0; i < n; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const s = Math.random() * 4 + 1;
        p.style.width = p.style.height = `${s}px`;
        p.style.left = `${Math.random() * 100}%`;
        p.style.top = `${Math.random() * 100}%`;
        const cols = ['rgba(255,107,107,0.7)','rgba(78,205,196,0.7)','rgba(254,202,87,0.7)'];
        p.style.background = cols[Math.floor(Math.random() * cols.length)];
        p.style.setProperty('--tx', `${(Math.random()-0.5)*200}px`);
        p.style.setProperty('--ty', `${(Math.random()-0.5)*200}px`);
        p.style.animationDuration = `${15 + Math.random() * 20}s`;
        c.appendChild(p);
      }
    }
  </script>
</body>
</html>
